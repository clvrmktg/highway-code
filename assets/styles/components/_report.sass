@use '../abstracts' as *

.issue
  background-color: color('bg-soft')

  > .wrapper
    grid-template-rows: max-content 0fr 0fr
    +transition(grid-template-rows)
    
    > *
      min-height: 0

    /* when usefulness panel is open */
    &:has(.issue__details.open)
      grid-template-rows: 0fr 1fr 0fr

    /* when tech report panel is open */
    &:has(.issue__report.open)           /* <-- note double underscore */
      grid-template-rows: 0fr 0fr 1fr

  // Top bar (Yes/No + Report button)
  &__bar
    grid-template-rows: 1fr
    +transition((grid-template-rows, opacity))

    +breakpoint(tablet)
      grid-template-columns: [use-start] auto [use-end] 1fr [report-start] auto [report-end]

      .page-use
        grid-column: use

      .report-button
        grid-column: report

    &.collapsed
      grid-template-rows: 0
      opacity: 0

    > .bar-inner
      min-height: 0         // lets the single track actually collapse
      overflow: hidden

    &[aria-hidden="true"]
      visibility: hidden

  // Collapsible panels (usefulness details + technical report)
  &__details, &__report
    block-size: 0                // collapse when closed
    overflow: hidden            // fallback
    @supports (overflow: clip)
      overflow: clip             // stronger clip when supported
    padding-block: 0             // prevent padding from forcing height
    margin-block: 0
    border-block-width: 0        // same for borders

    // visibility: hidden           // avoid paint when closed
    pointer-events: none         // no clicks
    clip-path: inset(0)          // robust paint clipping

    min-width: 0
    min-height: 0
    // Non-interactive when inert
    &[inert]
      pointer-events: none

    // Visually hidden (still no display:none)
    &[aria-hidden="true"]
      visibility: hidden
      +transition(visibility)
      
    &.open
      block-size: auto
      padding-block: var(--panel-padding, 1rem)
      border-block-width: initial
      visibility: visible
      pointer-events: auto
      clip-path: none
  // Respect reduced motion
  @media (prefers-reduced-motion: reduce)
    &__bar,
    &__details,
    &__report
      transition: none
