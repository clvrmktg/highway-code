{{- /* JSON-LD FAQPage (safe for --minify) */ -}}
{{- $src := .Params.faqs | default .Params.faq | default site.Params.faqs -}}
{{- if $src -}}
  {{- /* If provided as { items: [...] }, use items; else use the slice itself */ -}}
  {{- $iter := $src -}}
  {{- if isset $src "items" -}}
    {{- $iter = index $src "items" -}}
  {{- end -}}

  {{- $entities := slice -}}
  {{- range $i, $it := $iter -}}
    {{- /* Read question/answer defensively */ -}}
    {{- $q := "" -}}
    {{- $a := "" -}}

    {{- if isset $it "question" }}{{ $q = index $it "question" }}{{ end -}}
    {{- if and (eq $q "") (isset $it "q") }}{{ $q = index $it "q" }}{{ end -}}

    {{- if isset $it "answer" }}{{ $a = index $it "answer" }}{{ end -}}
    {{- if and (eq $a "") (isset $it "a") }}{{ $a = index $it "a" }}{{ end -}}

    {{- /* Optional: support a 2-item array like ["Q","A"] */ -}}
    {{- if and (eq $q "") (eq $a "") -}}
      {{- with index $it 0 }}{{ $q = . }}{{ end -}}
      {{- with index $it 1 }}{{ $a = . }}{{ end -}}
    {{- end -}}

    {{- /* Clean text for JSON-LD (strip HTML/MD, trim) */ -}}
    {{- $q = $q | markdownify | plainify | chomp -}}
    {{- $a = $a | markdownify | plainify | chomp -}}

    {{- if and $q $a -}}
      {{- $entities = $entities | append (dict
          "@type" "Question"
          "name"  $q
          "acceptedAnswer" (dict "@type" "Answer" "text" $a)
        ) -}}
    {{- end -}}
  {{- end -}}

  {{- if gt (len $entities) 0 -}}
    {{- $schema := dict
      "@context" "https://schema.org"
      "@type"    "FAQPage"
      "mainEntity" $entities
    -}}
    <!-- FAQs Schema -->
    <script type="application/ld+json">{{ $schema | jsonify (dict "indent" "  ") }}</script>
  {{- end -}}
{{- end -}}
