{{/* 
  Usage (one entry per line, pipe-delimited):
  LABEL | primary uses; supplementary notes | #hex   (hex optional)

  Example:
  RED   | STOP, YIELD, Do Not Enter, Wrong Way; prohibitions and regulatory symbols | #d32f2f
*/}}

{{- $raw := .Inner | replaceRE "\r\n?" "\n" | strings.TrimSpace -}}
{{- $lines := split $raw "\n" -}}

<table class="[ sign-colours ][ grid col-gap--1 pt--1 mb--2 ]">
  <thead>
    <tr class="[ py--0.5 ]">
      <th scope="col">Colour</th>
      <th scope="col">Primary use</th>
      <th scope="col">Supplementary</th>
    </tr>
  </thead>
  <tbody>
    {{- range $lines -}}
      {{- $line := . | strings.TrimSpace -}}
      {{- if $line -}}
        {{- $parts := split $line "|" -}}
        {{- if ge (len $parts) 2 -}}
          {{- $label := (index $parts 0) | strings.TrimSpace -}}
          {{- $uses  := (index $parts 1) | strings.TrimSpace -}}
          {{- $hex   := cond (ge (len $parts) 3) ((index $parts 2) | strings.TrimSpace) "" -}}
          {{- $slug  := $label | lower | urlize -}}

          {{/* Split uses into primary + supplementary at first semicolon */}}
          {{- $primary := $uses -}}
          {{- $supp := "" -}}
          {{- if in $uses ";" -}}
            {{- $useParts := split $uses ";" -}}
            {{- $primary = (index $useParts 0) | strings.TrimSpace -}}
            {{- $supp    = delimit (apply (after 1 $useParts) "strings.TrimSpace" ".") "; " -}}
          {{- end -}}

          <tr class="[ color color--{{ $slug }} ][ py--0.5 ]">
            <th scope="[ flex ]">
              <span class="swatch" {{ if $hex }}style="--swatch: {{ $hex }};"{{ end }} aria-hidden="true"></span>
              <span class="label">{{ $label }}</span>
            </th>
            <td>{{ $primary }}</td>
            <td>{{ $supp }}</td>
          </tr>
        {{- end -}}
      {{- end -}}
    {{- end -}}
  </tbody>
</table>
